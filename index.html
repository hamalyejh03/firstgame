<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Survie des Ã‰toiles</title>
<style>
    body {
        margin: 0;
        overflow: hidden;
        background: black;
        font-family: Arial, sans-serif;
        color: white;
        text-align: center;
    }

    canvas {
        display: block;
    }

    #gameOverScreen {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(88, 13, 13, 0.9);
        display: none;
        justify-content: center;
        align-items: center;
        flex-direction: column;
    }

    button {
        padding: 15px 30px;
        font-size: 18px;
        cursor: pointer;
        border: 6px solid red;
        border-radius: 10px;
        background: white;
        color: black;
        margin-top: 20px;
        transition: background 0.2s, color 0.2s, box-shadow 0.2s;
        box-shadow: 0 0 10px red, 0 0 20px red;
    }

    button:active {
        background: red;
        color: white;
        box-shadow: 0 0 20px red, 0 0 30px red;
    }
</style>
</head>
<body>

<canvas id="gameCanvas"></canvas>

<div id="gameOverScreen">
    <h1>Game Over</h1>
    <h2 id="finalScore"></h2>
    <button onclick="restartGame()">Try Again</button>
</div>

<script>
// =====================
// ðŸ”¹ Images
// =====================
let playerImg = new Image();
playerImg.src = "images/player.png";

let starImg = new Image();
starImg.src = "images/star.png";

let bombImg = new Image();
bombImg.src = "images/bomb.png";

let bgImg = new Image();
bgImg.src = "images/background.jpg";

// =====================
// ðŸ”¹ Canvas
// =====================
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// =====================
// ðŸ”¹ Joueur
// =====================
let player = {}; // initialisation vide, taille & position fixÃ©es dans resizeCanvas()

// =====================
// ðŸ”¹ Variables du jeu
// =====================
let stars = [];
let bombs = [];
let score = 0;
let starSpeed = 3;
let bombSpeed = 4;
let level = 1;
let gameRunning = true;

// =====================
// ðŸ”¹ Resize Canvas & Joueur responsive
// =====================
function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let scaleFactor = canvas.width / 1920; // basÃ© sur largeur desktop standard
    player.width = 50 * scaleFactor;
    player.height = player.width;

    player.x = canvas.width / 2 - player.width / 2;
    player.y = canvas.height - player.height - 10;
}

resizeCanvas();
window.addEventListener("resize", resizeCanvas);

// =====================
// ðŸ”¹ CrÃ©ation Ã©toiles et bombes selon le niveau
// =====================
function createStar() {
    if(gameRunning){
        for(let i = 0; i < level; i++){
            let x = Math.random() * (canvas.width - 20);
            stars.push({ x: x, y: -20, width: 20, height: 20 });
        }
    }
}

function createBomb() {
    if(gameRunning){
        for(let i = 0; i < level; i++){
            let x = Math.random() * (canvas.width - 20);
            bombs.push({ x: x, y: -20, width: 20, height: 20 });
        }
    }
}

// =====================
// ðŸ”¹ Fullscreen sur clic
// =====================
function goFullScreen() {
    if (canvas.requestFullscreen) canvas.requestFullscreen();
    else if (canvas.webkitRequestFullscreen) canvas.webkitRequestFullscreen();
    else if (canvas.msRequestFullscreen) canvas.msRequestFullscreen();
}

canvas.addEventListener("click", goFullScreen);

// =====================
// ðŸ”¹ Mettre Ã  jour la difficultÃ© selon score
// =====================
function updateDifficulty() {
    if(score < 10){ starSpeed = 3; bombSpeed = 4; level = 1; }
    else if(score < 25){ starSpeed = 5; bombSpeed = 6; level = 2; }
    else if(score < 40){ starSpeed = 7; bombSpeed = 8; level = 3; }
    else if(score < 70){ starSpeed = 9; bombSpeed = 10; level = 4; }
    else{ starSpeed = 11; bombSpeed = 12; level = 5; }
}

// =====================
// ðŸ”¹ Dessiner Ã©toiles
// =====================
function drawStars(){
    for(let i = 0; i < stars.length; i++){
        let star = stars[i];
        ctx.drawImage(starImg, star.x, star.y, star.width, star.height);
        star.y += starSpeed;

        if(star.x < player.x + player.width &&
           star.x + star.width > player.x &&
           star.y < player.y + player.height &&
           star.y + star.height > player.y){
            score++;
            stars.splice(i,1);
            i--;
            updateDifficulty();
        } else if(star.y > canvas.height){
            stars.splice(i,1);
            i--;
        }
    }
}

// =====================
// ðŸ”¹ Dessiner bombes
// =====================
function drawBombs(){
    for(let i = 0; i < bombs.length; i++){
        let bomb = bombs[i];
        ctx.drawImage(bombImg, bomb.x, bomb.y, bomb.width, bomb.height);
        bomb.y += bombSpeed;

        if(bomb.x < player.x + player.width &&
           bomb.x + bomb.width > player.x &&
           bomb.y < player.y + player.height &&
           bomb.y + bomb.height > player.y){
            endGame();
        } else if(bomb.y > canvas.height){
            bombs.splice(i,1);
            i--;
        }
    }
}

// =====================
// ðŸ”¹ Dessiner joueur
// =====================
function drawPlayer(){
    ctx.drawImage(playerImg, player.x, player.y, player.width, player.height);
}

// =====================
// ðŸ”¹ Dessiner score
// =====================
function drawScore(){
    ctx.fillStyle = "white";
    ctx.font = "24px Arial";
    ctx.fillText("Score: " + score, 20, 40);
}

// =====================
// ðŸ”¹ Boucle principale
// =====================
function gameLoop(){
    if(!gameRunning) return;

    ctx.drawImage(bgImg, 0, 0, canvas.width, canvas.height);

    drawPlayer();
    drawStars();
    drawBombs();
    drawScore();

    requestAnimationFrame(gameLoop);
}

// =====================
// ðŸ”¹ Game Over
// =====================
function endGame(){
    gameRunning = false;
    document.getElementById("finalScore").innerText = "Your score is " + score;
    document.getElementById("gameOverScreen").style.display = "flex";
}

// =====================
// ðŸ”¹ Restart
// =====================
function restartGame(){
    stars = [];
    bombs = [];
    score = 0;
    starSpeed = 3;
    bombSpeed = 4;
    level = 1;
    gameRunning = true;
    document.getElementById("gameOverScreen").style.display = "none";
    gameLoop();
}

// =====================
// ðŸ”¹ DÃ©placement du joueur
// =====================
canvas.addEventListener("mousemove", function(e){
    player.x = e.clientX - player.width / 2;
    if(player.x < 0) player.x = 0;
    if(player.x + player.width > canvas.width) player.x = canvas.width - player.width;
});

canvas.addEventListener("touchmove", function(e){
    e.preventDefault();
    let touch = e.touches[0];
    player.x = touch.clientX - player.width / 2;
    if(player.x < 0) player.x = 0;
    if(player.x + player.width > canvas.width) player.x = canvas.width - player.width;
}, {passive:false});

// =====================
// ðŸ”¹ Intervalles
// =====================
setInterval(createStar, 1200);
setInterval(createBomb, 3000);

// =====================
// ðŸ”¹ DÃ©marrage du jeu
// =====================
gameLoop();
</script>

</body>
</html>
